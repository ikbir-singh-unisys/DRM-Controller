import{r as o,v as J,j as e,n as b}from"./index-kH_MM8uZ.js";import{d as $}from"./dayjs.min-DPA6hWXm.js";import{b as f}from"./Urls-JdHTyFtR.js";const E=()=>{const[t,y]=o.useState({content_id:"",client_id:"",s3_input_id:"",s3_output_id:"",s3_source:"",s3_destination:"",is_paid:!1,upload_to_s3:!1,already_transcoded:!1}),[N,g]=o.useState([]),[a,k]=o.useState({}),[p,u]=o.useState(""),_=J(),r=localStorage.getItem("x-client-id"),h=localStorage.getItem("x-license-key"),x=r==="admin",[j,C]=o.useState([]),[S,v]=o.useState(!1);o.useEffect(()=>{const s=async()=>{try{const i=await b.get(`${f}/credentials`,{headers:{x_client_id:r,x_license_key:h,"Content-Type":"application/json"}});g(i.data)}catch(i){console.error("Failed to fetch credentials:",i)}},m=async()=>{var i;try{v(!0);const n=((i=(await b.get(`${f}/api/jobs`,{params:{limit:5,order:"desc"},headers:{x_client_id:r,x_license_key:h}})).data)==null?void 0:i.map(l=>({...l,submit_time:l.submit_time||l.created_at,finish_time:l.finish_time||l.updated_at,status:l.status.toUpperCase()})))||[];C(n)}catch(d){console.error("Failed to fetch recent jobs:",d)}finally{v(!1)}};s(),m()},[r,h]);const I=()=>{const s={};return t.content_id||(s.content_id="Content ID is required"),x&&!t.client_id&&(s.client_id="Client ID is required"),t.s3_input_id||(s.s3_input_id="Input S3 Credential is required"),t.s3_source||(s.s3_source="Source path is required"),t.upload_to_s3&&!t.s3_destination&&(s.s3_destination="Destination path is required when upload to S3 is enabled"),k(s),Object.keys(s).length===0},c=s=>{const{name:m,value:i,type:d,checked:n}=s.target;y(l=>({...l,[m]:d==="checkbox"?n:i}))},D=async s=>{var i,d;if(s.preventDefault(),u(""),!I())return;const m={...t,client_id:x?t.client_id:r,s3_input_id:parseInt(t.s3_input_id),s3_output_id:t.s3_output_id?parseInt(t.s3_output_id):parseInt(t.s3_input_id)};try{const n=await b.post(`${f}/api/jobcreate`,m,{headers:{x_client_id:r,x_license_key:h,"Content-Type":"application/json"}});u({type:"success",text:`✅ ${n.data.message} (Job ID: ${n.data.job_id})`}),setTimeout(()=>{_("/job-list")},2e3)}catch(n){console.error("Error creating job:",n);const w=((d=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:d.detail)||"❌ Failed to create job. Please check input and try again.";u({type:"error",text:w})}};return e.jsxs("div",{className:"container-fluid mt-4",children:[e.jsx("h3",{className:"mb-4",children:"Create New Job"}),p&&e.jsx("div",{className:`alert ${p.type==="success"?"alert-success":"alert-danger"}`,children:p.text}),e.jsxs("form",{onSubmit:D,className:"row g-3",children:[e.jsxs("div",{className:"row mt-4",children:[e.jsxs("div",{className:"col-md-6 mb-4",children:[e.jsx("label",{className:"form-label",children:"Content ID *"}),e.jsx("input",{type:"text",className:`form-control ${a.content_id?"is-invalid":""}`,name:"content_id",value:t.content_id,onChange:c,placeholder:"Unique content reference (e.g., video-abc-123)"}),a.content_id&&e.jsx("div",{className:"invalid-feedback",children:a.content_id})]}),x&&e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Client ID *"}),e.jsx("input",{type:"text",className:`form-control ${a.client_id?"is-invalid":""}`,name:"client_id",value:t.client_id,onChange:c,placeholder:"e.g., client123"}),a.client_id&&e.jsx("div",{className:"invalid-feedback",children:a.client_id})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"S3 Input Credential *"}),e.jsxs("select",{className:`form-select ${a.s3_input_id?"is-invalid":""}`,name:"s3_input_id",value:t.s3_input_id,onChange:c,children:[e.jsx("option",{value:"",children:"Select Credential"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.bucket,")"]},s.id))]}),a.s3_input_id&&e.jsx("div",{className:"invalid-feedback",children:a.s3_input_id})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"S3 Output Credential (Optional)"}),e.jsxs("select",{className:"form-select",name:"s3_output_id",value:t.s3_output_id,onChange:c,children:[e.jsx("option",{value:"",children:"Same as Input"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.bucket,")"]},s.id))]})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"S3 Source *"}),e.jsx("input",{type:"text",className:`form-control ${a.s3_source?"is-invalid":""}`,name:"s3_source",value:t.s3_source,onChange:c,placeholder:"s3://bucket-name/path/to/video.mp4"}),a.s3_source&&e.jsx("div",{className:"invalid-feedback",children:a.s3_source})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"S3 Destination (Optional)"}),e.jsx("input",{type:"text",className:`form-control ${a.s3_destination?"is-invalid":""}`,name:"s3_destination",value:t.s3_destination,onChange:c,placeholder:"Required only if Upload to S3 is enabled"}),a.s3_destination&&e.jsx("div",{className:"invalid-feedback",children:a.s3_destination})]}),e.jsxs("div",{className:"d-flex flex-row mb-2",children:[e.jsxs("div",{className:"p-2 form-check ps-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"is_paid",name:"is_paid",checked:t.is_paid,onChange:c}),e.jsx("label",{className:"form-check-label",htmlFor:"is_paid",children:"Is Paid"})]}),e.jsxs("div",{className:"p-2 form-check ps-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"upload_to_s3",name:"upload_to_s3",checked:t.upload_to_s3,onChange:c}),e.jsx("label",{className:"form-check-label",htmlFor:"upload_to_s3",children:"Upload to S3"})]}),e.jsxs("div",{className:"p-2 form-check ps-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"already_transcoded",name:"already_transcoded",checked:t.already_transcoded,onChange:c}),e.jsx("label",{className:"form-check-label",htmlFor:"already_transcoded",children:"Already Transcoded"})]})]})]}),e.jsxs("div",{className:"col-12 mt-0",children:[e.jsx("button",{type:"button",className:"btn btn-secondary me-3",onClick:()=>_(-1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Job"})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"mb-4",children:"Recent Jobs"}),e.jsxs("div",{className:"border rounded p-2 shadow-sm",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table mb-0",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Job ID"}),e.jsx("th",{children:"Content ID"}),e.jsx("th",{children:"S3 Input File Path"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Submitted"})]})}),e.jsx("tbody",{children:S?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-3",children:"Loading recent jobs..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-3",children:"No recent jobs found"})}):j.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-monospace text-underline text-secondary",style:{cursor:"pointer"},onClick:()=>_(`/jobs/${s.job_id}`),children:s.job_id}),e.jsx("td",{children:s.content_id}),e.jsx("td",{children:s.s3_source}),e.jsx("td",{children:e.jsx("span",{children:s.status})}),e.jsx("td",{children:$(s.submit_time).format("YYYY-MM-DD HH:mm")})]},s.job_id))})]})}),e.jsxs("div",{className:"card-footer text-end small text-muted mt-2",children:["Showing ",j.length," most recent jobs"]})]})]})]})};export{E as default};
