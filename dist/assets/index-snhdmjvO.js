import{r as i,n as f,j as e}from"./index-kH_MM8uZ.js";import{b as p}from"./Urls-JdHTyFtR.js";const R=()=>{const[a,y]=i.useState({name:"",access_key:"",secret_key:"",bucket:"",region:"",client_id:""}),[h,_]=i.useState([]),[l,C]=i.useState({}),[x,j]=i.useState(null),d=localStorage.getItem("x-client-id"),u=localStorage.getItem("x-license-key"),t=d==="admin",[c,v]=i.useState(null),[S,g]=i.useState(!1);i.useEffect(()=>{N()},[d,u]);const N=async()=>{try{const s=await f.get(`${p}/credentials`,{headers:{x_client_id:d,x_license_key:u,"Content-Type":"application/json"}});_(s.data)}catch(s){console.error("Failed to fetch credentials:",s)}},w=()=>{const s={};return a.name||(s.name="Name is required"),a.access_key||(s.access_key="Access Key is required"),a.secret_key||(s.secret_key="Secret Key is required"),a.bucket||(s.bucket="Bucket is required"),a.region||(s.region="Region is required"),t&&!a.client_id&&(s.client_id="Client ID is required"),C(s),Object.keys(s).length===0},n=s=>{const{name:b,value:r}=s.target;y(o=>({...o,[b]:r}))},D=s=>{v(s),g(!0)},I=()=>{g(!1),v(null)},k=s=>!s||s.length<=8?"XXXX":`${s.substring(0,4)} .......... ${s.slice(-4)}`,$=async s=>{var r,o;if(s.preventDefault(),j(null),!w())return;const b={...a,client_id:t?a.client_id:d};try{await f.post(`${p}/credentials`,b,{headers:{x_client_id:d,x_license_key:u,"Content-Type":"application/json"}}),j({type:"success",text:"✅ Credential added successfully."}),y({name:"",access_key:"",secret_key:"",bucket:"",region:"",client_id:""}),N()}catch(m){console.error("Error adding credential:",m);const K=((o=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:o.detail)||"❌ Failed to add credential. Please try again.";j({type:"error",text:K})}};return e.jsxs("div",{className:"container-fluid mt-4",children:[e.jsx("h3",{className:"mb-4",children:"Add S3 Credential"}),x&&e.jsx("div",{className:`alert ${x.type==="success"?"alert-success":"alert-danger"}`,children:x.text}),e.jsxs("form",{onSubmit:$,className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Name *"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:n,className:`form-control ${l.name?"is-invalid":""}`}),l.name&&e.jsx("div",{className:"invalid-feedback",children:l.name})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Access Key *"}),e.jsx("input",{type:"text",name:"access_key",value:a.access_key,onChange:n,className:`form-control ${l.access_key?"is-invalid":""}`}),l.access_key&&e.jsx("div",{className:"invalid-feedback",children:l.access_key})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Secret Key *"}),e.jsx("input",{type:"text",name:"secret_key",value:a.secret_key,onChange:n,className:`form-control ${l.secret_key?"is-invalid":""}`}),l.secret_key&&e.jsx("div",{className:"invalid-feedback",children:l.secret_key})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bucket *"}),e.jsx("input",{type:"text",name:"bucket",value:a.bucket,onChange:n,className:`form-control ${l.bucket?"is-invalid":""}`}),l.bucket&&e.jsx("div",{className:"invalid-feedback",children:l.bucket})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Region *"}),e.jsx("input",{type:"text",name:"region",value:a.region,onChange:n,className:`form-control ${l.region?"is-invalid":""}`}),l.region&&e.jsx("div",{className:"invalid-feedback",children:l.region})]}),t&&e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Client ID *"}),e.jsx("input",{type:"text",name:"client_id",value:a.client_id,onChange:n,className:`form-control ${l.client_id?"is-invalid":""}`}),l.client_id&&e.jsx("div",{className:"invalid-feedback",children:l.client_id})]}),e.jsx("div",{className:"col-12 ",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Add Credential"})})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Existing Credentials"}),e.jsx("button",{className:"btn btn-outline-primary rounded-pill",onClick:N,children:"Refresh"})]}),e.jsxs("div",{className:"border rounded p-2 shadow-sm",children:[e.jsx("div",{className:"table-responsive",style:{maxHeight:"calc(100vh - 400px)"},children:e.jsxs("table",{className:"table mb-0",children:[e.jsx("thead",{className:" sticky-top",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Bucket"}),e.jsx("th",{children:"Region"}),t&&e.jsx("th",{children:"Client ID"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t?6:5,className:"text-center py-4",children:"No credentials found"})}):h.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-monospace",children:s.id}),e.jsx("td",{children:s.name}),e.jsx("td",{className:"text-truncate",style:{maxWidth:"200px"},children:s.bucket}),e.jsx("td",{children:s.region}),t&&e.jsx("td",{children:s.client_id}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>D(s),children:"View"})})]},s.id))})]})}),e.jsxs("div",{className:"card-footer text-end small text-muted mt-2",children:["Showing ",h.length," credentials"]})]}),S&&c&&e.jsx("div",{className:"modal fade show centered",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Credential Details"}),e.jsx("button",{type:"button",className:"btn-close",onClick:I})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Basic Information"}),e.jsxs("dl",{className:"row",children:[e.jsx("dt",{className:"col-sm-4",children:"ID"}),e.jsx("dd",{className:"col-sm-8",children:c.id}),e.jsx("dt",{className:"col-sm-4",children:"Name"}),e.jsx("dd",{className:"col-sm-8",children:c.name}),e.jsx("dt",{className:"col-sm-4",children:"Bucket"}),e.jsx("dd",{className:"col-sm-8",children:c.bucket}),e.jsx("dt",{className:"col-sm-4",children:"Region"}),e.jsx("dd",{className:"col-sm-8",children:c.region})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Security Information"}),e.jsxs("dl",{className:"row",children:[e.jsx("dt",{className:"col-sm-4",children:"Access Key"}),e.jsx("dd",{className:"col-sm-8",children:k(c.access_key)}),e.jsx("dt",{className:"col-sm-4",children:"Secret Key"}),e.jsx("dd",{className:"col-sm-8",children:k(c.secret_key)}),t&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"col-sm-4",children:"Client ID"}),e.jsx("dd",{className:"col-sm-8",children:c.client_id})]})]})]})]})})]})})})]})};export{R as default};
