import{v as Y,r as s,j as e,n as H}from"./index-kH_MM8uZ.js";import{d as J}from"./dayjs.min-DPA6hWXm.js";import{b as P}from"./Urls-JdHTyFtR.js";const W=()=>{const N=Y(),O=["COMPLETED","PROCESSING","FAILED","QUEUED"],f=["Job ID","S3 Input File Path","Submit time","Last Upadated At","Status","Job percent complete"],[n,v]=s.useState([]),[c,S]=s.useState(""),[o,y]=s.useState(""),[a,_]=s.useState(""),[r,d]=s.useState(""),[i,$]=s.useState(5),[m,M]=s.useState(!0),[C,D]=s.useState(!1),[p,w]=s.useState(!1),u=s.useRef(0),b=s.useRef(null),E=s.useRef(!1),T=localStorage.getItem("x-client-id"),k=localStorage.getItem("x-license-key"),h=!!c||!!a||!!r||!!o,x=async(t=!1,F={})=>{var L;try{w(!0);const g=t?0:u.current,U={limit:i,offset:g,...c&&{status:c.toLowerCase()},...a&&{date_from:a},...r&&{date_to:r},...o&&{job_id:o},...F},j=((L=(await H.get(`${P}/api/jobs`,{params:U,headers:{x_client_id:T,x_license_key:k}})).data)==null?void 0:L.map(l=>({...l,submit_time:l.submit_time||l.created_at,finish_time:l.finish_time||l.updated_at,job_percent_complete:l.progress!=null?`${l.progress}%`:""})))||[];t?(v(j),u.current=i):(v(l=>[...l,...j]),u.current+=i),M(j.length===i)}catch(g){console.error("Failed to fetch jobs:",g)}finally{w(!1)}},A=()=>{S(""),_(""),d(""),y(""),D(!1)};s.useEffect(()=>{if(!E.current){E.current=!0;return}u.current=0,x(!0)},[c,a,r,o,i]),s.useEffect(()=>{x(!0)},[]);const I=s.useCallback(t=>{t[0].isIntersecting&&m&&!p&&x(!1)},[m,p]);s.useEffect(()=>{const t=new IntersectionObserver(I,{threshold:1});return b.current&&t.observe(b.current),()=>t.disconnect()},[I]);const R=t=>{switch(t.toUpperCase()){case"COMPLETED":return"bg-success";case"FAILED":return"bg-danger";case"PROCESSING":return"bg-primary";case"QUEUED":return"bg-warning";default:return"bg-secondary"}};return e.jsxs("div",{className:"container-fluid mt-4 py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap",children:[e.jsx("h3",{className:"mb-2",children:"Jobs"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn rounded-pill btn-outline-primary",onClick:()=>x(!0),disabled:p,children:"Refresh"}),e.jsx("button",{className:"btn rounded-pill btn-outline-primary",onClick:()=>!h&&D(t=>!t),disabled:h,children:C||h?"Hide Filters":"Show Filters"}),h&&e.jsx("button",{className:"btn btn-outline-secondary rounded-pill",onClick:A,children:"Clear Filters"}),e.jsx("button",{className:"btn rounded-pill btn-warning",onClick:()=>N("/job-create"),children:"Create Job"})]})]}),C&&e.jsx("div",{className:"card p-3 mb-3 shadow-sm",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Job ID"}),e.jsx("input",{type:"text",className:"form-control",value:o,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:c,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"",children:"Any status"}),O.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Date From"}),e.jsx("input",{type:"date",className:"form-control",value:a,max:r||void 0,onChange:t=>{_(t.target.value),r&&t.target.value>r&&d("")},onKeyDown:t=>t.preventDefault()})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Date To"}),e.jsx("input",{type:"date",className:"form-control",value:r,min:a||void 0,onChange:t=>{!a||t.target.value>=a?d(t.target.value):d("")},onKeyDown:t=>t.preventDefault(),disabled:!a}),r&&a&&r<a&&e.jsx("div",{className:"text-danger small mt-1",children:"End date must be after start date"})]})]})}),e.jsxs("div",{className:"border rounded p-2 shadow-sm",children:[e.jsx("div",{className:"table-responsive",style:{maxHeight:"calc(80vh - 100px)"},children:e.jsxs("table",{className:"table mb-0",children:[e.jsx("thead",{className:"sticky-top",children:e.jsx("tr",{children:f.map(t=>e.jsx("th",{children:t},t))})}),e.jsxs("tbody",{children:[n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:f.length,className:"text-center py-4",children:"No jobs found"})}):n.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{cursor:"pointer"},onClick:()=>N(`/jobs/${t.job_id}`),className:"text-monospace text-decoration-underline text-primary",children:t.job_id}),e.jsx("td",{className:"text-truncate",style:{maxWidth:"300px"},children:t.s3_source}),e.jsx("td",{children:J(t.submit_time).format("YYYY-MM-DD HH:mm:ss")}),e.jsx("td",{children:J(t.finish_time).format("YYYY-MM-DD HH:mm:ss")}),e.jsx("td",{children:e.jsx("span",{className:`badge ${R(t.status)} text-uppercase`,children:t.status})}),e.jsx("td",{children:t.job_percent_complete})]},t.job_id)),n.length!==0&&m&&e.jsx("tr",{ref:b,children:e.jsx("td",{colSpan:f.length,className:"text-center text-muted py-2",children:"Loading more..."})})]})]})}),e.jsxs("div",{className:"card-footer text-end small text-muted mt-2",children:["Showing ",n.length," records",m&&n.length!==0&&" (scroll to load more)"]})]})]})};export{W as default};
